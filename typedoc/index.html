<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>rpc_ts</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link
	href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700"
	rel="stylesheet"
	/>
	<link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono" rel="stylesheet">
	<link
	rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
	integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
	crossorigin="anonymous"
	/>
	<link rel="stylesheet" href="assets/css/main.css">
	<link rel="stylesheet" href="../assets/css/styles.css" />
</head>
<body>
<header id="site-navbar">
	<div class="tsd-page-toolbar">
		<div class="container-typedoc">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.js" data-base=".">
					<div class="field">
						<ul class="link-container">
							<li class="link-item leave-at-xs-sm"><a class="nav-link" href="/rpc_ts/#examples">Examples</a></li>
							<li class="link-item leave-at-xs-sm"><a class="nav-link" href="/rpc_ts/#why">Why rpc_ts?</a></li>
							<li class="link-item leave-at-xs-sm"><a class="nav-link" href="/rpc_ts/#articles">Articles</a></li>
							<li class="link-item leave-at-xs-sm"><a href="/rpc_ts/typedoc/modules/modulerpcclient.html" class="nav-link active">Reference</a></li>
							<a href="https://github.com/aiden/rpc_ts" target="_blank"><li class="link-item" id="github-link">
									<img src="/rpc_ts/assets/images/github.svg" />
									GitHub
							</li></a>
						</ul>
						<label for="tsd-search-field" class="tsd-widget search no-caption leave-at-xs-sm" style="">Search</label>
						<input id="tsd-search-field" type="text" height="40" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="/#top" class="title ">rpc_ts</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<!-- <div id="header-github-button">Github</div> -->
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
</header>
<div class="container-typedoc container-typedoc-main">
	<div class="row">
		<div id="vertical-line" class="leave-at-xs-sm"></div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ol class="module-list">
					<!-- <li class="globals  ">
                <a href="globals.html"><em>Globals</em></a>
            </li> -->
					<li class=" tsd-kind-external-module">
						<div class="module-item-number"></div>
						<a href="modules/modulerpcclient.html">Module<wbr>Rpc<wbr>Client</a>
					</li>
					<li class=" tsd-kind-external-module">
						<div class="module-item-number"></div>
						<a href="modules/modulerpccommon.html">Module<wbr>Rpc<wbr>Common</a>
					</li>
					<li class=" tsd-kind-external-module">
						<div class="module-item-number"></div>
						<a href="modules/modulerpccontextclient.html">Module<wbr>Rpc<wbr>Context<wbr>Client</a>
					</li>
					<li class=" tsd-kind-external-module">
						<div class="module-item-number"></div>
						<a href="modules/modulerpccontextcommon.html">Module<wbr>Rpc<wbr>Context<wbr>Common</a>
					</li>
					<li class=" tsd-kind-external-module">
						<div class="module-item-number"></div>
						<a href="modules/modulerpccontextserver.html">Module<wbr>Rpc<wbr>Context<wbr>Server</a>
					</li>
					<li class=" tsd-kind-external-module">
						<div class="module-item-number"></div>
						<a href="modules/modulerpcprotocolclient.html">Module<wbr>Rpc<wbr>Protocol<wbr>Client</a>
					</li>
					<li class=" tsd-kind-external-module">
						<div class="module-item-number"></div>
						<a href="modules/modulerpcprotocolgrpcwebclient.html">Module<wbr>Rpc<wbr>Protocol<wbr>Grpc<wbr>Web<wbr>Client</a>
					</li>
					<li class=" tsd-kind-external-module">
						<div class="module-item-number"></div>
						<a href="modules/modulerpcprotocolgrpcwebcommon.html">Module<wbr>Rpc<wbr>Protocol<wbr>Grpc<wbr>Web<wbr>Common</a>
					</li>
					<li class=" tsd-kind-external-module">
						<div class="module-item-number"></div>
						<a href="modules/modulerpcprotocolgrpcwebserver.html">Module<wbr>Rpc<wbr>Protocol<wbr>Grpc<wbr>Web<wbr>Server</a>
					</li>
					<li class=" tsd-kind-external-module">
						<div class="module-item-number"></div>
						<a href="modules/modulerpcprotocolmock.html">Module<wbr>Rpc<wbr>Protocol<wbr>Mock</a>
					</li>
					<li class=" tsd-kind-external-module">
						<div class="module-item-number"></div>
						<a href="modules/modulerpcprotocolserver.html">Module<wbr>Rpc<wbr>Protocol<wbr>Server</a>
					</li>
					<li class=" tsd-kind-external-module">
						<div class="module-item-number"></div>
						<a href="modules/modulerpcserver.html">Module<wbr>Rpc<wbr>Server</a>
					</li>
				</ol>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
		<div class="col-8 col-content">
			<div class="tsd-page-title">
				<h1>rpc_ts</h1>
			</div>
			<div class="tsd-panel tsd-typography">
				<h1 id="rpc_ts-remote-procedure-calls-in-typescript-made-simple-">rpc_ts: Remote Procedure Calls in TypeScript made simple 🤞</h1>
				<p><a href="https://circleci.com/gh/aiden/rpc_ts/tree/master"><img src="https://circleci.com/gh/aiden/rpc_ts/tree/master.svg?style=svg" alt="CircleCI"></a> <a href="https://coveralls.io/github/aiden/rpc_ts?branch=master"><img src="https://coveralls.io/repos/github/aiden/rpc_ts/badge.svg?branch=master" alt="Coverage Status"></a> <a href="https://badge.fury.io/js/rpc_ts"><img src="https://badge.fury.io/js/rpc_ts.svg" alt="npm version"></a> <a href="https://aleen42.github.io/badges/src/typescript.svg"><img src="./docs/typescript.svg" alt="typescript"></a> <a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT"></a> <a href="https://github.com/prettier/prettier"><img src="https://img.shields.io/badge/code_style-prettier-ff69b4.svg" alt="code style: prettier"></a></p>
				<p>rpc_ts is a framework for doing typesafe <a href="https://en.wikipedia.org/wiki/Remote_procedure_call">Remote Procedure Calls (RPC)</a> in TypeScript. It uses no <a href="https://en.wikipedia.org/wiki/Domain-specific_language">Domain-Specific Language</a> such as <a href="https://developers.google.com/protocol-buffers/">Protocol Buffers</a> or <a href="https://thrift.apache.org/">Apache Thrift</a>: the services are all defined using the powerful TypeScript type system. This approach is particularly suitable for shortening the development cycle of isomorphic web applications that rely on TypeScript for both frontend and backend development.</p>
				<p>rpc_ts supports both unary calls and server-side streaming and is fully compatible with the <a href="https://github.com/grpc/grpc-web">grpc-web+json</a> protocol (an adaptation of the popular gRPC protocol for the web). It has been designed with a relentless focus on modularity, simplicity, and robustness, and does not require the use of an intermediate gRPC proxy.</p>
				<h2 id="examples">Examples</h2>
				<h3 id="chat-room">Chat room</h3>
				<p><a href="https://github.com/aiden/rpc_ts_chat"><img src="docs/rpc_ts_chat_demo.gif" alt="Chat room"></a></p>
				<p>The <a href="https://github.com/aiden/rpc_ts_chat">chat room</a> example showcases error handling and real-time with rpc_ts, and also best practices.</p>
				<h3 id="primer">Primer</h3>
				<p>This is how a minimal RPC service with one procedure, <code>getHello</code>, looks like:</p>
				<pre><code class="language-Typescript"><span class="hljs-keyword">import</span> { ModuleRpcCommon } <span class="hljs-keyword">from</span> <span class="hljs-string">'rpc_ts/lib/common'</span>;
<span class="hljs-keyword">import</span> { ModuleRpcServer } <span class="hljs-keyword">from</span> <span class="hljs-string">'rpc_ts/lib/server'</span>;
<span class="hljs-keyword">import</span> { ModuleRpcProtocolServer } <span class="hljs-keyword">from</span> <span class="hljs-string">'rpc_ts/lib/protocol/server'</span>;
<span class="hljs-keyword">import</span> { ModuleRpcProtocolClient } <span class="hljs-keyword">from</span> <span class="hljs-string">'rpc_ts/lib/protocol/client'</span>;

<span class="hljs-comment">// Definition of the RPC service</span>
<span class="hljs-keyword">const</span> helloServiceDefinition = {
  getHello: {
    request: {} <span class="hljs-keyword">as</span> { language: <span class="hljs-built_in">string</span> },
    response: {} <span class="hljs-keyword">as</span> { text: <span class="hljs-built_in">string</span> },
  },
};

<span class="hljs-comment">// Implementation of an RPC server</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">'http'</span>;
<span class="hljs-keyword">const</span> app = express();
<span class="hljs-keyword">const</span> handler: ModuleRpcServer.ServiceHandlerFor&lt;<span class="hljs-keyword">typeof</span> helloServiceDefinition&gt; = {
  <span class="hljs-keyword">async</span> getHello({ language }) {
    <span class="hljs-keyword">if</span> (language === <span class="hljs-string">'Spanish'</span>) <span class="hljs-keyword">return</span> { text: <span class="hljs-string">'Hola'</span> };
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ModuleRpcServer.ServerRpcError(
      ModuleRpcCommon.RpcErrorType.notFound,
      <span class="hljs-string">`language '<span class="hljs-subst">${language}</span>' not found`</span>,
    );
  },
};
app.use(ModuleRpcProtocolServer.registerRpcRoutes(helloServiceDefinition, handler));
<span class="hljs-keyword">const</span> server = http.createServer(app).listen();

<span class="hljs-comment">// Now let's do a Remote Procedure Call</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rpc</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> { text } = <span class="hljs-keyword">await</span> ModuleRpcProtocolClient.getRpcClient(helloServiceDefinition, {
    remoteAddress: <span class="hljs-string">`http://localhost:<span class="hljs-subst">${server.address().port}</span>`</span>
  }).nice().getHello({ language: <span class="hljs-string">'Spanish'</span> });
  <span class="hljs-comment">// (Notice that, with TypeScript typing, it is not possible to mess up the</span>
  <span class="hljs-comment">// type of the request: for instance, `.getHello({ lang: 'Spanish' })`</span>
  <span class="hljs-comment">// will error.)</span>

  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Hello:'</span>, text);
}

rpc().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> server.close()).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
  <span class="hljs-built_in">console</span>.error(err);
  process.exit(<span class="hljs-number">1</span>);
});</code></pre>
				<h2 id="why-rpc_ts-">Why rpc_ts?</h2>
				<p>Bootstrapping an HTTP REST API over JSON is extremely simple in dynamic languages such as Python and JavaScript. With the right framework, it is possible to write a client/server interaction in a few lines of codes. This simplicity comes from that the conversion to and from untyped JSON feels natural, but also that no explicit contract is specified between the client and the user.</p>
				<p>On the other side of the spectrum, both gRPC and Thrift are built around Interface Definition Languages that provide such a contract. They have also been developed with performance in mind, and their primary application is compiled languages with static typing such as C++ and Java, even though they are also available in Python, JavaScript, and other dynamic languages. However,</p>
				<ol>
					<li><p>The IDLs must be translated to clients and server stubs in the target languages, adding an additional building step.</p>
					</li>
					<li><p>The service definition lives in at least two languages, sometimes three: the IDL, the server-side language and the client-side language (if they are different).</p>
					</li>
					<li><p>The very rigid IDL type system fights against, rather than helps, the &quot;native&quot; type constructs and tends to <a href="http://reasonablypolymorphic.com/blog/protos-are-wrong/">contaminate more and more of the code base</a>. This is especially saddening with regards to TypeScript and its well-crafted system of <a href="https://en.wikipedia.org/wiki/Algebraic_data_type">algebraic data types</a> (algebraic data types are very cool).</p>
					</li>
				</ol>
				<p><strong>We believe that rpc_ts fills an important gap in the RPC ecosystem: it provides a hassle-free way to define APIs in an expressive language, TypeScript, so that we can build isomorphic applications faster.</strong> 🏖</p>
				<h2 id="the-protocol">The protocol</h2>
				<p>The protocol we implement is gRPC-Web with a JSON codec (a.k.a, <code>grpc-web+json</code>), as introduced <a href="https://github.com/grpc/grpc/blob/master/doc/PROTOCOL-WEB.md">here</a>. So we are not reinventing anything here, we are just making the whole process simpler (🤞).</p>
				<h2 id="other-projects">Other projects</h2>
				<p>The <a href="https://github.com/grpc/grpc-web">gRPC-Web reference implementation of a JavaScript client</a>, based on a Protocol Buffer codec, is now <a href="https://www.cncf.io/blog/2018/10/24/grpc-web-is-going-ga/">generally available</a>. There also exists a <a href="https://github.com/improbable-eng/grpc-web">TypeScript-first implementation</a> of a gRPC-Web client, again with Protocol Buffers, and a Golang server.</p>
				<p>Our implementation, to the best of our knowledge, is the first implementation of a gRPC-Web server in TypeScript, and the first implementation of gRPC-Web which can work with arbitrary codecs, including JSON, and the first that does not necessitate compiling the service definition from a foreign Interface Definition Language.</p>
				<h2 id="runtime-type-checks">Runtime type checks</h2>
				<p>In the context of an isomorphic web application running on Node.js, rpc_ts is typesafe as long as both the client and the server are compiled from the same codebase and share the same service definition. This is a real shortcoming for public APIs as well as a security issue. Fortunately, the TypeScript compiler can be very easily plugged into. We are using such runtime type checking internally and are also in the process of open sourcing it so that this I/O boundary can be addressed.</p>
				<h2 id="concepts">Concepts</h2>
				<p>A <em>service</em> handles Remote Procedure Calls (RPCs), or methods, taking requests and giving back responses.</p>
				<p>A service has two implementations: a <em>client,</em> and a <em>server</em> (the server delegates the actual execution to a <em>handler</em>). The actual <em>transportation protocol,</em> linking the client to the server, is abstracted away by the RPC system. This transportation protocol needs to serialize/encode and deserialize/decode the requests and responses from their in-memory representation, suitable for manipulation by the clients and handlers, to an encoded representation that can be transmitted on the wire. This process, handled by a <em>codec,</em> must be fast to provide high throughput and must produce small encoded messages to limit network latency.</p>
				<h3 id="contexts">Contexts</h3>
				<p>The requests and responses are augmented with <em>contexts</em> (either <em>request contexts</em> or <em>response contexts</em>). Contexts are added by <em>context connectors</em> and contain meta information that pertains to the remote nature of the procedure call. A rule of thumb is that a piece of information belongs to a context if it wouldn&#39;t make sense to include it in the request or response of a procedure call that occurred locally, within the same OS process. Additionally, context connectors can abort an RPC if some precondition is not met. Context connectors can be used to:</p>
				<ul>
					<li>ensure that the requester is properly authenticated and authorized,</li>
					<li>inject user data concerning the requester (such as user ID, user locale, time zone, or perhaps user preferences in general),</li>
					<li>inject identifiers for <a href="http://opentracing.io/documentation/">distributed tracing</a>,</li>
					<li>provide timestamping to deal with out-of-order responses.</li>
				</ul>
				<p>Context connectors are always paired (there is always a client-side and a server-side context connectors for the same feature).</p>
				<p>Go to the <a href="./src/examples/context">context</a> example to see how it works in the context of authentication.</p>
				<h3 id="unary-calls-and-server-streams">Unary calls and server streams</h3>
				<p>RPCs can be classified according to how requests and responses intermingle during the call:</p>
				<ul>
					<li>Unary RPCs: a single request is followed by a single response;</li>
					<li>Server streams: a single request is followed by multiple responses (they can be sent at different points in time);</li>
					<li>Client streams: multiple requests are followed by a single response;</li>
					<li>Bidirectional streams, requests and responses can be sent at arbitrary points in time.</li>
				</ul>
				<p>Unary RPCs and server streams can be implemented using half duplexes (think of &quot;walkie-talkies&quot; where the two parties to the communication cannot communicate at the same time), client and bidirectional streams require a full duplex communication (where simultaneous communication is possible). This has implications for the transportation layer used. For example, client and bidirectional streams cannot be implemented in HTTP/1.1 and, whereas the HTTP2 RFC provides a full duplex, the current browser interface to HTTP2 allows only for a half duplex (in the browser, full duplexes can be implemented using WebSocket). That&#39;s why for, now, gRPC-Web, including our implementation, only supports unary calls and server streams.</p>
				<p>Go to the <a href="./src/examples/server_stream">server_stream</a> example to see how server streams are implemented with rpc_ts.</p>
				<h2 id="license">License</h2>
				<p>rpc_ts is licensed under the MIT License.</p>
			</div>
		</div>
	</div>
</div>
<footer id="aiden-footer">
	<div class="container-fluid">
		<div class="row gutter">
			<div class="col-md-4 col-menu">
				<!-- Spacer -->
			</div>
			<div class="col-md-8 pl-md-4 col-content">
				<div class="footer-signature">
					<div id="footer-copy">
						<svg id="footer-icon" width="24px" height="25px" viewBox="0 0 24 25">
							<g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
								<g id="Aiden.ai-Grey" transform="translate(-540.000000, -105.000000)" fill="#fff">
									<g id="Group">
										<g transform="translate(513.000000, 87.000000)">
											<g id="Group-6-Copy-7" transform="translate(27.000000, 18.000000)">
												<g id="Group-3">
													<path d="M11.9107877,0 C5.33265963,0 0,5.06334459 0,11.3092578 C0,17.5552362 5.33265963,22.6185156 11.9107877,22.6185156 C11.9362657,22.6185156 11.9615377,22.6177331 11.9870156,22.6176027 L20.9008778,24.3536364 L18.9368064,20.4413009 C21.8978843,18.3838688 23.8215754,15.060079 23.8215754,11.3092578 C23.8215754,5.06334459 18.4889844,0 11.9107877,0 Z" id="Fill-1"></path>
												</g>
											</g>
										</g>
									</g>
								</g>
							</g>
						</svg>
						<div>Made at <a href="https://www.aiden.ai/" target="_blank">Aiden.ai</a> Engineering</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</footer>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="assets/js/search.js"><' + '/script>');</script>
<script
src="https://code.jquery.com/jquery-3.3.1.min.js"
crossorigin="anonymous"
></script>
<script
src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
crossorigin="anonymous"
></script>
<script
src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
crossorigin="anonymous"
></script>
<script type="text/javascript" src="../assets/index.js"></script>
</body>
</html>